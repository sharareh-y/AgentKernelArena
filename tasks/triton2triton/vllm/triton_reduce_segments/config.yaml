source_file_path:
  - source/triton_reduce_segments.py

target_kernel_functions:
  - reduce_segments

compile_command:
  - python3 scripts/task_runner.py compile

correctness_command:
  - python3 scripts/task_runner.py correctness

performance_command:
  - python3 scripts/task_runner.py performance

task_type: triton2triton

task_result_template: null

prompt:
  source_code: null
  instructions: |
    Optimize the Triton kernel `reduce_segments` for maximum GPU throughput
    while maintaining numerical correctness.

    This kernel performs logsumexp-based reduction of partial attention outputs
    from segmented parallel softmax. Each segment has partial output, max, and
    expsum values. The kernel combines them:
      overall_max = max(segm_max[0..N])
      rescaled_expsum[i] = expsum[i] * exp(segm_max[i] - overall_max)
      overall_expsum = sum(rescaled_expsum)
      output = sum(segm_output[i] * exp(segm_max[i] - overall_max)) / overall_expsum

    Constraints:
    - Must maintain the same function signature for `reduce_attention_segments`
    - Output must match reference within atol=1e-2, rtol=1e-2 for float16/float32
  cheatsheet: null
