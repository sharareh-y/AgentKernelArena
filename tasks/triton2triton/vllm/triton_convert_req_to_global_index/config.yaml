source_file_path:
  - source/triton_convert_req_to_global_index.py

target_kernel_functions:
  - _convert_req_index_to_global_index_kernel

compile_command:
  - python3 scripts/task_runner.py compile

correctness_command:
  - python3 scripts/task_runner.py correctness

performance_command:
  - python3 scripts/task_runner.py performance

task_type: triton2triton

task_result_template: null

prompt:
  source_code: null
  instructions: |
    Optimize the Triton kernel `_convert_req_index_to_global_index_kernel` for
    maximum GPU throughput while maintaining numerical correctness.

    This kernel translates request-local token indices to global cache slot indices
    using a block table lookup:
      out[i,j] = block_table[req_id[i], tok[i,j] // BLOCK_SIZE] * BLOCK_SIZE
                 + tok[i,j] % BLOCK_SIZE

    Invalid tokens (== -1) or out-of-bounds block indices produce -1 in the output.
    Optionally counts valid (non -1) entries per row via atomic add.

    Key optimization opportunities:
    - Coalesced memory access patterns
    - Tile width (BLOCK_N) tuning
    - Minimizing atomic contention for valid count tracking

    Constraints:
    - Must maintain the same function signature for `convert_req_to_global_index`
    - Output must exactly match reference (int32 indices)
  cheatsheet: null
